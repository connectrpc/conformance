name: Basic
# TODO: define more test cases
testCases:
- request:
    testName: unary success
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnaryRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        responseData: "dGVzdCByZXNwb25zZQ=="
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
  expectedResponse:
    responseHeaders:
    - name: X-Custom-Header
      value: ["foo","bar","baz"]
    payloads:
    - data: "dGVzdCByZXNwb25zZQ=="
      requestInfo:
        requestHeaders:
        - name: X-Conformance-Test
          value: ["Value1","Value2"]
        requests:
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnaryRequest
          responseDefinition:
            responseHeaders:
            - name: x-custom-header
              value: ["foo","bar","baz"]
            responseData: "dGVzdCByZXNwb25zZQ=="
            responseTrailers:
            - name: x-custom-trailer
              value: ["bing","quux"]
    responseTrailers:
    - name: X-Custom-Trailer
      value: ["bing","quux"]
- request:
    testName: unary empty response
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnaryRequest
      responseDefinition:
  expectedResponse:
    payloads:
    - data:
      requestInfo:
        requests:
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnaryRequest
          responseDefinition:
- request:
    testName: client stream success
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ClientStream
    streamType: STREAM_TYPE_CLIENT_STREAM
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        responseData: "dGVzdCByZXNwb25zZQ=="
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    responseHeaders:
    - name: X-Custom-Header
      value: ["foo","bar","baz"]
    payloads:
    - data: "dGVzdCByZXNwb25zZQ=="
      requestInfo:
        requestHeaders:
        - name: X-Conformance-Test
          value: ["Value1","Value2"]
        requests:
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
          responseDefinition:
            responseHeaders:
            - name: x-custom-header
              value: ["foo","bar","baz"]
            responseData: "dGVzdCByZXNwb25zZQ=="
            responseTrailers:
            - name: x-custom-trailer
              value: ["bing","quux"]
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
          requestData: "dGVzdCByZXNwb25zZQ=="
    responseTrailers:
    - name: X-Custom-Trailer
      value: ["bing","quux"]
- request:
    testName: client stream empty response
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ClientStream
    streamType: STREAM_TYPE_CLIENT_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
      responseDefinition:
  expectedResponse:
    payloads:
    - data:
      requestInfo:
        requests:
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
          responseDefinition:
- request:
    testName: server stream success
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ServerStream
    streamType: STREAM_TYPE_SERVER_STREAM
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ServerStreamRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
  expectedResponse:
    responseHeaders:
    - name: X-Custom-Header
      value: ["foo","bar","baz"]
    payloads:
    - data: "dGVzdCByZXNwb25zZQ=="
      requestInfo:
        requestHeaders:
        - name: X-Conformance-Test
          value: ["Value1","Value2"]
        requests:
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ServerStreamRequest
          responseDefinition:
            responseHeaders:
            - name: x-custom-header
              value: ["foo","bar","baz"]
            responseData:
              - "dGVzdCByZXNwb25zZQ=="
              - "dGVzdCByZXNwb25zZQ=="
            responseTrailers:
            - name: x-custom-trailer
              value: ["bing","quux"]
    - data: "dGVzdCByZXNwb25zZQ=="
    responseTrailers:
    - name: X-Custom-Trailer
      value: ["bing","quux"]
- request:
    testName: server stream empty response
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ServerStream
    streamType: STREAM_TYPE_SERVER_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ServerStreamRequest
      responseDefinition:
  expectedResponse:
- request:
    testName: server stream error with responses
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ServerStream
    streamType: STREAM_TYPE_SERVER_STREAM
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ServerStreamRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
        error:
          code: 13
          message: "server stream failed"
          details:
            - "@type": "connectrpc.conformance.v1alpha1.Header"
              name: "test error detail name"
              value:
                - "test error detail value"
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
  expectedResponse:
    responseHeaders:
    - name: X-Custom-Header
      value: ["foo","bar","baz"]
    payloads:
    - data: "dGVzdCByZXNwb25zZQ=="
      requestInfo:
        requestHeaders:
        - name: X-Conformance-Test
          value: ["Value1","Value2"]
        requests:
        - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ServerStreamRequest
          responseDefinition:
            responseHeaders:
            - name: x-custom-header
              value: ["foo","bar","baz"]
            responseData:
              - "dGVzdCByZXNwb25zZQ=="
              - "dGVzdCByZXNwb25zZQ=="
            error:
              code: 13
              message: "server stream failed"
              details:
                - "@type": "connectrpc.conformance.v1alpha1.Header"
                  name: "test error detail name"
                  value:
                    - "test error detail value"
            responseTrailers:
            - name: x-custom-trailer
              value: ["bing","quux"]
    - data: "dGVzdCByZXNwb25zZQ=="
    error:
      code: 13
      message: "server stream failed"
      details:
        - "@type": "connectrpc.conformance.v1alpha1.Header"
          name: "test error detail name"
          value:
            - "test error detail value"
    responseTrailers:
    - name: X-Custom-Trailer
      value: ["bing","quux"]
