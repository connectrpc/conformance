name: Bidi Timeouts
# TODO - Need to fix the timeout issues with wrapping context deadline. Right now
# these tests break for gRPC until that issue is addressed
relevantProtocols:
  - PROTOCOL_CONNECT
  - PROTOCOL_GRPC_WEB
testCases:
- request:
    testName: bidi full duplex timeout
    service: connectrpc.conformance.v1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_FULL_DUPLEX_BIDI_STREAM
    timeoutMs: 200
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      responseDefinition:
        responseDelayMs: 500
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
      fullDuplex: true
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  # Override
  expectedResponse:
    error:
      code: 4
- request:
    testName: bidi half duplex timeout
    service: connectrpc.conformance.v1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_HALF_DUPLEX_BIDI_STREAM
    timeoutMs: 200
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      responseDefinition:
        responseDelayMs: 500
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  # Override
  expectedResponse:
    error:
      code: 4
