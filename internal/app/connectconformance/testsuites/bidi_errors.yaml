me: Bidi
relevantHttpVersions:
    - HTTP_VERSION_2
testCases:
- request:
    testName: bidi half duplex stream error
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_HALF_DUPLEX_BIDI_STREAM
    requestHeaders:
      - name: X-Conformance-Test
        value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.BidiStreamRequest
      responseDefinition:
        responseHeaders:
          - name: x-custom-header
            value: ["foo","bar","baz"]
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
        error:
          code: 13
          message: "bidi half duplex stream failed"
          details:
            - "@type": "type.googleapis.com/connectrpc.conformance.v1alpha1.Header"
              name: "test error detail name"
              value:
                - "test error detail value"
        responseTrailers:
          - name: x-custom-trailer
            value: ["bing","quux"]
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    responseHeaders:
      - name: X-Custom-Header
        value: ["foo","bar","baz"]
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requestHeaders:
            - name: X-Conformance-Test
              value: ["Value1","Value2"]
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.BidiStreamRequest
              responseDefinition:
                responseHeaders:
                  - name: x-custom-header
                    value: ["foo","bar","baz"]
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
                responseTrailers:
                  - name: x-custom-trailer
                    value: ["bing","quux"]
            - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.BidiStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requestHeaders:
            - name: X-Conformance-Test
              value: ["Value1","Value2"]
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.BidiStreamRequest
              responseDefinition:
                responseHeaders:
                  - name: x-custom-header
                    value: ["foo","bar","baz"]
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
                responseTrailers:
                  - name: x-custom-trailer
                    value: ["bing","quux"]
            - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.BidiStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
        error:
          code: 13
          message: "bidi half duplex stream failed"
          details:
            - "@type": "google.protobuf.Any"
              typeUrl: "type.googleapis.com/connectrpc.conformance.v1alpha1.Header"
              value:
                name: "test error detail name"
                value:
                  - "test error detail value"
        responseTrailers:
          - name: X-Custom-Trailer
            value: ["bing","quux"]
