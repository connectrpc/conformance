name: Connect to HTTP Code Mapping
mode: TEST_MODE_CLIENT
# This test suite represents tests that are specific to the Connect protocol only.
relevantProtocols:
  - PROTOCOL_CONNECT
testCases:
- request:
    testName: unary/canceled-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 1
  expectedResponse:
    wireDetails:
      actualStatusCode: 408
      actualHttpTrailers: []
    error:
      code: 1
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 1
- request:
    testName: unary/unknown-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 2
  expectedResponse:
    wireDetails:
      actualStatusCode: 500
      actualHttpTrailers: []
    error:
      code: 2
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 2
- request:
    testName: unary/invalid-argument-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 3
  expectedResponse:
    wireDetails:
      actualStatusCode: 400
      actualHttpTrailers: []
    error:
      code: 3
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 3
- request:
    testName: unary/deadline-exceeded-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 4
  expectedResponse:
    wireDetails:
      actualStatusCode: 408
      actualHttpTrailers: []
    error:
      code: 4
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 4
- request:
    testName: unary/not-found-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 5
  expectedResponse:
    wireDetails:
      actualStatusCode: 404
      actualHttpTrailers: []
    error:
      code: 5
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 5
- request:
    testName: unary/already-exists-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 6
  expectedResponse:
    wireDetails:
      actualStatusCode: 409
      actualHttpTrailers: []
    error:
      code: 6
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 6
- request:
    testName: unary/permission-denied-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 7
  expectedResponse:
    wireDetails:
      actualStatusCode: 403
      actualHttpTrailers: []
    error:
      code: 7
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 7
- request:
    testName: unary/resource-exhausted-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 8
  expectedResponse:
    wireDetails:
      actualStatusCode: 429
      actualHttpTrailers: []
    error:
      code: 8
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 8
- request:
    testName: unary/failed-precondition-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 9
  expectedResponse:
    wireDetails:
      actualStatusCode: 412
      actualHttpTrailers: []
    error:
      code: 9
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 9
- request:
    testName: unary/aborted-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 10
  expectedResponse:
    wireDetails:
      actualStatusCode: 409
      actualHttpTrailers: []
    error:
      code: 10
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 10
- request:
    testName: unary/out-of-range-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 11
  expectedResponse:
    wireDetails:
      actualStatusCode: 400
      actualHttpTrailers: []
    error:
      code: 11
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 11
- request:
    testName: unary/unimplemented-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 12
  expectedResponse:
    wireDetails:
      actualStatusCode: 404
      actualHttpTrailers: []
    error:
      code: 12
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 12
- request:
    testName: unary/internal-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 13
  expectedResponse:
    wireDetails:
      actualStatusCode: 500
      actualHttpTrailers: []
    error:
      code: 13
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 13
- request:
    testName: unary/unavailable-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 14
  expectedResponse:
    wireDetails:
      actualStatusCode: 503
      actualHttpTrailers: []
    error:
      code: 14
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 14
- request:
    testName: unary/data-loss-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 15
  expectedResponse:
    wireDetails:
      actualStatusCode: 500
      actualHttpTrailers: []
    error:
      code: 15
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 15
- request:
    testName: unary/unauthenticated-error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        error:
          code: 16
  expectedResponse:
    wireDetails:
      actualStatusCode: 401
      actualHttpTrailers: []
    error:
      code: 16
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                error:
                  code: 16
- request:
    testName: unary/bad-request-error/http-to-connect-code-mapping
    testName: bad request
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        responseData: "dGVzdCByZXNwb25zZQ=="
        rawResponse:
          statusCode: 400
  expectedResponse:
    error:
      # invalid_argument
      code: 3
- request:
    testName: unary/unauthorized-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 401
  expectedResponse:
    error:
      # unauthenticated
      code: 16
- request:
    testName: unary/forbidden-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 403
  expectedResponse:
    error:
      # permission_denied
      code: 7
- request:
    testName: unary/not-found-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 404
  expectedResponse:
    error:
      # unimplemented
      code: 12
- request:
    testName: unary/request-timeout-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 408
  expectedResponse:
    error:
      # deadline_exceeded
      code: 4
# TODO - uncomment when conformance is updated to the latest release of connect-go
# that includes this fix
# - request:
    # testName: unary/conflict-error/http-to-connect-code-mapping
#     service: connectrpc.conformance.v1.ConformanceService
#     method: Unary
#     streamType: STREAM_TYPE_UNARY
#     requestMessages:
#     - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
#       responseDefinition:
#         rawResponse:
#           statusCode: 409
#  expectedResponse:
#    error:
#     # aborted
#      code: 10
- request:
    testName: unary/precondition-failed-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 412
  expectedResponse:
    error:
      # failed_precondition
      code: 9
- request:
    testName: unary/payload-too-large-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 413
  expectedResponse:
    error:
      # resource_exhausted
      code: 8
# TODO - uncomment when conformance is updated to the latest release of connect-go
# that includes this fix
# - request:
    # testName: unary/unsupported-media-type-error/http-to-connect-code-mapping
#     service: connectrpc.conformance.v1.ConformanceService
#     method: Unary
#     streamType: STREAM_TYPE_UNARY
#     requestMessages:
#     - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
#       responseDefinition:
#         rawResponse:
#           statusCode: 415
#  expectedResponse:
#    error:
#     # internal
#      code: 13
- request:
    testName: unary/too-many-requests-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 429
  expectedResponse:
    error:
      # unavailable
      code: 14
- request:
    testName: unary/request-header-fields-too-large-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 431
  expectedResponse:
    error:
      # resource_exhausted
      code: 8
- request:
    testName: unary/bad-gateway-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 502
  expectedResponse:
    error:
      # unavailable
      code: 14
- request:
    testName: unary/service-unavailable-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 503
  expectedResponse:
    error:
      # unavailable
      code: 14
- request:
    testName: unary/gateway-timeout-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 504
  expectedResponse:
    error:
      # unavailable
      code: 14
- request:
    testName: unary/unmapped-error/http-to-connect-code-mapping
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 418
  expectedResponse:
    error:
      # unknown
      code: 2
- request:
    testName: unary/success/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        responseData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
              responseDefinition:
                responseData: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: client-stream/error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: ClientStream
    streamType: STREAM_TYPE_CLIENT_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
      responseDefinition:
        error:
          code: 13
          message: "client stream failed"
    - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    error:
      code: 13
      details: 
        - "@type": type.googleapis.com/connectrpc.conformance.v1.ConformancePayload.RequestInfo
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
              responseDefinition:
                error:
                  code: 13
                  message: "client stream failed"
            - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: client-stream/success/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: ClientStream
    streamType: STREAM_TYPE_CLIENT_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
      responseDefinition:
        responseData: "dGVzdCByZXNwb25zZQ=="
    - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
              responseDefinition:
                responseData: "dGVzdCByZXNwb25zZQ=="
            - "@type": type.googleapis.com/connectrpc.conformance.v1.ClientStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: server-stream/success/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: ServerStream
    streamType: STREAM_TYPE_SERVER_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.ServerStreamRequest
      responseDefinition:
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.ServerStreamRequest
              responseDefinition:
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
      - data: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: server-stream/error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: ServerStream
    streamType: STREAM_TYPE_SERVER_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.ServerStreamRequest
      responseDefinition:
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
        error:
          code: 13
          message: "server stream failed"
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    error:
      code: 13
      message: "server stream failed"
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.ServerStreamRequest
              responseDefinition:
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
                error:
                  code: 13
                  message: "server stream failed"
      - data: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: bidi-full-duplex/success/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_FULL_DUPLEX_BIDI_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      responseDefinition:
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
      fullDuplex: true
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              responseDefinition:
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
              fullDuplex: true
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: bidi-full-duplex/error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_FULL_DUPLEX_BIDI_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      responseDefinition:
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
        error:
          code: 13
          message: "bidi half duplex stream failed"
      fullDuplex: true
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    error:
      code: 13
      message: "bidi half duplex stream failed"
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              responseDefinition:
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
                error:
                  code: 13
                  message: "bidi half duplex stream failed"
              fullDuplex: true
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: bidi-half-duplex/success/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_HALF_DUPLEX_BIDI_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      responseDefinition:
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              responseDefinition:
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
      - data: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: bidi-half-duplex/error/has-correct-wire-details
    service: connectrpc.conformance.v1.ConformanceService
    method: BidiStream
    streamType: STREAM_TYPE_HALF_DUPLEX_BIDI_STREAM
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      responseDefinition:
        responseData:
          - "dGVzdCByZXNwb25zZQ=="
          - "dGVzdCByZXNwb25zZQ=="
        error:
          code: 13
          message: "bidi half duplex stream failed"
    - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
  expectedResponse:
    wireDetails:
      actualStatusCode: 200
      actualHttpTrailers: []
    error:
      code: 13
      message: "bidi half duplex stream failed"
    payloads:
      - data: "dGVzdCByZXNwb25zZQ=="
        requestInfo:
          requests:
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              responseDefinition:
                responseData:
                  - "dGVzdCByZXNwb25zZQ=="
                  - "dGVzdCByZXNwb25zZQ=="
                error:
                  code: 13
                  message: "bidi half duplex stream failed"
            - "@type": type.googleapis.com/connectrpc.conformance.v1.BidiStreamRequest
              requestData: "dGVzdCByZXNwb25zZQ=="
      - data: "dGVzdCByZXNwb25zZQ=="
