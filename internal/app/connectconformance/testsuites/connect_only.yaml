# Tests designed for running only over the Connect protocol.
name: Connect Only Tests
relevantProtocols:
  - PROTOCOL_CONNECT
testCases:
- request:
    testName: unary error
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnaryRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        error:
          code: 13
          message: "unary failed"
          details:
            - "@type": "connectrpc.conformance.v1alpha1.Header"
              name: "test error detail name"
              value:
                - "test error detail value"
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
- request:
    testName: unary error unicode
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnaryRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        error:
          code: 13
          message: "\ntest with whitespace\r\nand Unicode BMP â˜º and non-BMP ðŸ˜ˆ\n"
          details:
            - "@type": "connectrpc.conformance.v1alpha1.Header"
              name: "test error detail name"
              value:
                - "test error detail value"
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
- request:
    testName: client stream error
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ClientStream
    streamType: STREAM_TYPE_CLIENT_STREAM
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        error:
          code: 13
          message: "client stream failed"
          details:
            - "@type": "connectrpc.conformance.v1alpha1.Header"
              name: "test error detail name"
              value:
                - "test error detail value"
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ClientStreamRequest
      requestData: "dGVzdCByZXNwb25zZQ=="
- request:
    testName: unimplemented
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: Unimplemented
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.UnimplementedRequest
  # Override
  expectedResponse:
    error:
      code: 12
      message: "connectrpc.conformance.v1alpha1.ConformanceService.Unimplemented is not implemented"
- request:
    testName: server stream error with no responses
    service: connectrpc.conformance.v1alpha1.ConformanceService
    method: ServerStream
    streamType: STREAM_TYPE_SERVER_STREAM
    requestHeaders:
    - name: X-Conformance-Test
      value: ["Value1","Value2"]
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1alpha1.ServerStreamRequest
      responseDefinition:
        responseHeaders:
        - name: x-custom-header
          value: ["foo","bar","baz"]
        error:
          code: 13
          message: "server stream failed"
          details:
            - "@type": "connectrpc.conformance.v1alpha1.Header"
              name: "test error detail name"
              value:
                - "test error detail value"
        responseTrailers:
        - name: x-custom-trailer
          value: ["bing","quux"]
