name: Unexpected Responses
mode: TEST_MODE_CLIENT
relevantCompressions:
  - COMPRESSION_IDENTITY
relevantCodecs:
  - CODEC_PROTO
testCases:
- request:
    testName: unmapped HTTP status code
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 418 # I'm a teapot
  expectedResponse:
    error:
      # unknown
      code: 2
- request:
    testName: nonexistent HTTP status code
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 800
  expectedResponse:
    error:
      # unknown
      code: 2
# TODO - Fixed in https://github.com/connectrpc/connect-go/pull/679 
# Uncomment when released
# - request:
#     testName: unexpected content type 
#     streamType: STREAM_TYPE_UNARY
#     requestMessages:
#     - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
#       responseDefinition:
#         rawResponse:
#           headers:
#             - name: Content-Type
#               value: ["junk"]
#   expectedResponse:
#     error:
#       # internal
#       code: 13
