name: Unexpected
mode: TEST_MODE_CLIENT
relevantProtocols:
  - PROTOCOL_CONNECT
testCases:
- request:
    testName: unmapped HTTP status code
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 418
  expectedResponse:
    error:
      # unknown
      code: 2
- request:
    testName: nonexistent HTTP status code
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 800
  expectedResponse:
    error:
      # unknown
      code: 2
# TODO - This doesn't seem to be failing at all
# - request:
#     testName: unexpected content type 
#     service: connectrpc.conformance.v1.ConformanceService
#     method: Unary
#     streamType: STREAM_TYPE_UNARY
#     requestMessages:
#     - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
#       responseDefinition:
#         rawResponse:
#           headers:
#             - name: Content-Type
#               value: ["junk"]
#   expectedResponse:
#     error:
#       # unknown
#       code: 2
- request:
    testName: unexpected content encoding 
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          headers:
            - name: Content-Encoding
              value: ["invalid"]
  expectedResponse:
    error:
      # internal
      code: 13
