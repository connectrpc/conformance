name: Unexpected response values
mode: TEST_MODE_CLIENT
relevantCompressions:
  - COMPRESSION_GZIP
relevantCodecs:
  - CODEC_JSON
testCases:
- request:
    testName: unmapped HTTP status code
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 418
  expectedResponse:
    error:
      # unknown
      code: 2
- request:
    testName: nonexistent HTTP status code
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          statusCode: 800
  expectedResponse:
    error:
      # unknown
      code: 2
# TODO - Fixed in https://github.com/connectrpc/connect-go/pull/679 
# Uncomment when released
# - request:
#     testName: unexpected content type 
#     service: connectrpc.conformance.v1.ConformanceService
#     method: Unary
#     streamType: STREAM_TYPE_UNARY
#     requestMessages:
#     - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
#       responseDefinition:
#         rawResponse:
#           headers:
#             - name: Content-Type
#               value: ["junk"]
#   expectedResponse:
#     error:
#       # internal
#       code: 13
- request:
    testName: unexpected content encoding 
    service: connectrpc.conformance.v1.ConformanceService
    method: Unary
    streamType: STREAM_TYPE_UNARY
    requestMessages:
    - "@type": type.googleapis.com/connectrpc.conformance.v1.UnaryRequest
      responseDefinition:
        rawResponse:
          unary:
            text: "{\"payload\": {\"data\": \"dGVzdCByZXNwb25zZQ\"}}" 
          headers:
            - name: content-type
              value: [ "application/json" ]
            - name: content-encoding
              value: ["br"]
  expectedResponse:
    error:
      # internal
      code: 13
